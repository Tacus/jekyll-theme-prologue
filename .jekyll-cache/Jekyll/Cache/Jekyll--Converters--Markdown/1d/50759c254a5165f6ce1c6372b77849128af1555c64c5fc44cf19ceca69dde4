I"Ã<p><strong>Chapter 4. Strings</strong></p>

<p>Strings represent text. A string in Lua can contain a single letter or an entire book. Programs that manip- ulate strings with 100K or 1M characters are not unusual in Lua.</p>

<p>Strings in Lua are sequences of bytes. The Lua core is agnostic about how these bytes encode text. Lua is eight-bit clean and its strings can contain bytes with any numeric code, including embedded zeros. This means that we can store any binary data into a string. We can also store Unicode strings in any representation (UTF-8, UTF-16, etc.); however, as we will discuss, there are several good reasons to use UTF-8 whenever possible. The standard string library that comes with Lua assumes one-byte characters, but it can handle UTF-8 strings quite reasonably. Moreover, since version 5.3, Lua comes with a small library to help the use of UTF-8 encoding.</p>

<p>Strings in Lua are immutable values. We cannot change a character inside a string, as we can in C; instead, we create a new string with the desired modifications, as in the next example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>              a = "one string"
              b = string.gsub(a, "one", "another")  -- change string parts
              print(a)       --&gt; one string
              print(b)       --&gt; another string
</code></pre></div></div>

<p>Strings in Lua are subject to automatic memory management, like all other Lua objects (tables, functions, etc.). This means that we do not have to worry about allocation and deallocation of strings; Lua handles it for us.</p>

<p>Strings ä»£è¡¨æ–‡æœ¬ã€‚åœ¨luaä¸­ä¸€ä¸ªstring å¯ä»¥åŒ…å«ä¸€ä¸ªå­—æ¯ï¼Œæˆ–è€…æ•´æœ¬ä¹¦ã€‚åœ¨ç¨‹åºé‡Œé¢ç»´æŠ¤ä¸€ä¸ª100kæˆ–è€…1mçš„å­—ç¬¦æ˜¯éå¸¸å¸¸ç”¨çš„ã€‚</p>

<p>Stringsåœ¨luaä¸­æ˜¯å­—èŠ‚åºåˆ—ã€‚lua æ ¸å¿ƒå¹¶ä¸çŸ¥é“è¿™ä¸ªå­—èŠ‚æ€ä¹ˆç¼–ç æˆæ–‡æœ¬ã€‚luaæ˜¯å®Œæ•´çš„8æ¯”ç‰¹ä½å¹¶ä¸”å®ƒçš„å­—ç¬¦ä¸²å¯ä»¥å­˜å‚¨ä»»ä½•äºŒè¿›åˆ¶æ•°æ®ã€‚æˆ‘ä»¬åŒæ ·å¯ä»¥å­˜å‚¨unicode ä»¥ä»»ä½•å½¢å¼è¡¨ç¤ºæ–¹æ³•ã€‚å°±åƒæˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„ï¼Œè¿™é‡Œæœ‰nå¤šç†ç”±è®©æˆ‘ä»¬å°½å¯èƒ½ä½¿ç”¨utf8æ–¹å¼ç¼–ç ã€‚luaè‡ªå¸¦çš„æ ‡å‡†string åº“éƒ½å‡è®¾luaæ˜¯å•å­—èŠ‚å­—ç¬¦ï¼Œä½†æ˜¯å®ƒä¹Ÿå¯ä»¥åˆç†çš„å¤„ç†utf8å­—ç¬¦ä¸²ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œ5.3ç‰ˆæœ¬ä¹‹åluaè‡ªå¸¦ä¸€ä¸ªstring åº“ç”¨ä»¥å¤„ç†utf8çš„ç¼–ç ã€‚</p>

<p>luaä¸­çš„å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„å€¼ã€‚æˆ‘ä»¬ä¸èƒ½åƒåœ¨cä¸­ä¸€æ ·æ”¹å˜ä¸€ä¸ªå­—ç¬¦ä¸²çš„å­—ç¬¦ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„æ¥è¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„ä¿®æ”¹ã€‚å°±åƒä¸‹é¢çš„ä¾‹å­ä¸€æ ·</p>

<p>stringsçš„å†…å­˜åœ¨luaä¸­æ˜¯è‡ªåŠ¨ç®¡ç†ï¼Œå°±åƒå…¶ä»–çš„ç±»å‹ã€‚è¿™æ„å‘³ç€ï¼Œæˆ‘ä»¬ä¸ç”¨å»æ‹…å¿ƒå®ƒçš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾ã€‚luaæ›¿æˆ‘ä»¬å¤„ç†å®ƒã€‚</p>

<p>We can get the length of a string using the <em>length operator</em> (denoted by #):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>              a = "hello"
              print(#a)             --&gt; 5
              print(#"good bye")    --&gt; 8
</code></pre></div></div>

<p>æˆ‘ä»¬å¯ä»¥è·å–stringçš„é•¿åº¦é€šè¿‡é•¿åº¦æ“ä½œç¬¦#</p>

<p>This operator always counts the length in bytes, which is not the same as characters in some encodings.</p>

<p>We can concatenate two strings with the concatenation operator .. (two dots). If any operand is a number, Lua converts this number to a string:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>              &gt; "Hello " .. "World"     --&gt; Hello World
              &gt; "result is " .. 3       --&gt; result is 3
</code></pre></div></div>

<p>#æ“ä½œç¬¦æŒ‰ç…§å­—èŠ‚æ¥è®¡ç®—stringçš„é•¿åº¦ï¼Œè¿™å’ŒæŸä¸ªç¼–ç çš„å­—ç¬¦ä¸ªæ•°æ˜¯ä¸åŒçš„ã€‚
æˆ‘ä»¬å¯ä»¥ç”¨ä¸¤ä¸ªç‚¹..è¿æ¥ä¸¤ä¸ªstringã€‚å¦‚æœæŸä¸€ä¸ªæ“ä½œæ•°æ˜¯æ•°å­—ï¼Œluaä¼šå°†æ•°å­—è½¬æˆstringã€‚</p>

<p>(Some languages use the plus sign for concatenation, but 3 + 5 is different from 3 .. 5.)<br />
Remember that strings in Lua are immutable values. The concatenation operator always creates a new</p>

<p>string, without any modification to its operands:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>			&gt; a = "Hello"  
			&gt; a .. " World" --&gt; Hello World &gt;a --&gt; Hello
</code></pre></div></div>

<p>ä¸€äº›è¯­è¨€ä½¿ç”¨+å·ç”¨ä½œè¿æ¥ï¼Œä½†æ˜¯3+5å’Œ3..5æ˜¯ä¸åŒçš„ã€‚
è¯·è®°ä½stringåœ¨luaä¸­æ˜¯ä¸å¯å˜çš„å€¼ã€‚è¿æ¥æ“ä½œç¬¦æ€»æ˜¯ä¼šåˆ›å»ºæ–°çš„å­—ç¬¦ä¸²ï¼Œè€Œä¸ä¼šæ”¹å˜å®ƒçš„æ“ä½œæ•°ã€‚</p>

<p>Literal strings
We can delimit literal strings by single or double matching quotes:</p>

<p><code class="language-plaintext highlighter-rouge">a = "a line"
b = 'another line'</code>
They are equivalent; the only difference is that inside each kind of quote we can use the other quote without escapes.
As a matter of style, most programmers always use the same kind of quotes for the same kind of strings, where the â€œkindsâ€ of strings depend on the program. For instance, a library that manipulates XML may reserve single-quoted strings for XML fragments, because those fragments often contain double quotes.
Strings in Lua can contain the following C-like escape sequences:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>| :-----| ----: |
| \a | bell | 
| \b | back space | 
| \f | form feed |
| \n |  newline |
| \t |  horizontal tab |
| \r |  carriage return |
| \v |  vertical tab |
| \ | backslash |
| " | double quote |
| ' | single quote |

single quote
The following examples illustrate their use:
&gt; print("one line\nnext line\n"in quotes", 'in quotes'")
one line
next line
"in quotes", 'in quotes'
&gt; print('a backslash inside quotes: '\'')
a backslash inside quotes: ''
&gt; print("a simpler way: '\'")
a simpler way: ''
We can specify a character in a literal string also by its numeric value through the escape sequences \ddd and \xhh, where ddd is a sequence of up to three decimal digits and hh is a sequence of exactly two hexadecimal digits. As a somewhat artificial example, the two literals "ALO\n123"" and '\x41LO \10\04923"' have the same value in a system using ASCII: 0x41 (65 in decimal) is the ASCII code for A, 10 is the code for newline, and 49 is the code for the digit 1. (In this example we must write 49 with three digits, as \049, because it is followed by another digit; otherwise Lua would read the escape as \492.) We could also write that same string as '\x41\x4c\x4f\x0a\x31\x32\x33\x22', representing each character by its hexadecimal code.
Since Lua 5.3, we can also specify UTF-8 characters with the escape sequence \u{h... h}; we can write any number of hexadecimal digits inside the brackets:
</code></pre></div></div>

<p>â€\u{3b1} \u{3b2} \u{3b3}â€ â€“&gt; # # # (The above example assumes an UTF-8 terminal.)</p>
:ET